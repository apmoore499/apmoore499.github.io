<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Step 1. Set up venv - Archer</title><link rel="shortcut icon" href="http://localhost:4000/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="http://localhost:4000/assets/css/just-the-docs.css"> <script type="text/javascript" src="http://localhost:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Step 1. Set up venv | Archer</title><meta name="generator" content="Jekyll v3.8.5" /><meta property="og:title" content="Step 1. Set up venv" /><meta property="og:locale" content="en_US" /><meta name="description" content="PhD repository" /><meta property="og:description" content="PhD repository" /><link rel="canonical" href="http://localhost:4000/docs/circuitSNP/venv/" /><meta property="og:url" content="http://localhost:4000/docs/circuitSNP/venv/" /><meta property="og:site_name" content="Archer" /> <script type="application/ld+json"> {"@type":"WebPage","headline":"Step 1. Set up venv","url":"http://localhost:4000/docs/circuitSNP/venv/","description":"PhD repository","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000" class="site-title lh-tight"> Archer </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item"><a href="http://localhost:4000/" class="navigation-list-link">Home</a><li class="navigation-list-item active"><a href="http://localhost:4000/docs/circuitSNP/circuitSNP/" class="navigation-list-link">circuitSNP</a><ul class="navigation-list-child-list "><li class="navigation-list-item active"><a href="http://localhost:4000/docs/circuitSNP/venv/" class="navigation-list-link active">Step 1. Set up venv</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/circuitSNP/jupyter_usage/" class="navigation-list-link">2. Starting Jupyter Notebook</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/hpc/spartan/" class="navigation-list-link">Spartan HPC Usage</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/hpc/slurm/" class="navigation-list-link">Slurm example script</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/hpc/copying_data_to_hpc/" class="navigation-list-link">Copying to HPC</a><li class="navigation-list-item "><a href="http://localhost:4000/docs/hpc/anaconda_notes/" class="navigation-list-link">Anaconda device</a></ul><li class="navigation-list-item"><a href="http://localhost:4000/docs/jekyll_maintenance/jekyll_setup/" class="navigation-list-link">Web Development</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="http://localhost:4000/docs/jekyll_maintenance/github/" class="navigation-list-link">Configuring site for GH hosting</a></ul></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Archer" aria-label="Search Archer" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg></div><div class="js-search-results search-results-wrap"></div></div></div><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/circuitSNP/circuitSNP/">circuitSNP</a><li class="breadcrumb-nav-list-item"><span>Step 1. Set up venv</span></ol></nav><div id="main-content" class="page-content" role="main"><h2 id="setting-up-virtual-environment"> <a href="#setting-up-virtual-environment" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Setting up virtual environment.</h2><p>Instructions to set up python virtual environment on hpc cluster.</p><p>Once the virtual environment is set up, you should be able to run all code in jupyter notebook.</p><p>You will need to have access to gpgpu partition.</p><p>You need to set up a virtualenv to run the circuitSNPs jupyter notebook. Virtualenv keeps all the python libraries in one place - this is useful because libraries are always being updated, so if you want to run code that you worked on a year ago, often it won’t work with new libraries.</p><p>On spartan, we can set up virtualenv as follows:</p><ul><li><h3 id="step-1-log-in-to-spartan-account-via-terminal"> <a href="#step-1-log-in-to-spartan-account-via-terminal" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 1. Log in to spartan account via terminal</h3></ul><p><img src="terminal.png" alt="" /></p><p>All following instructions involve typing commands into bash terminal.</p><ul><li><h3 id="step-2-run-interactive-session-on-gpgpu-node---we-need-gpgpu"> <a href="#step-2-run-interactive-session-on-gpgpu-node---we-need-gpgpu" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 2. Run interactive session on gpgpu node - we need GPGPU</h3></ul><p>Options for different user may change.</p><p>I needed to set <code class="highlighter-rouge">--qos=gpgpumdhs</code>, please ask spartan helpdesk if having problems.</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sinteractive <span class="nt">--nodes</span> 1 <span class="nt">--account</span><span class="o">=</span>punim0614 <span class="nt">--partition</span> gpgpu <span class="nt">--qos</span><span class="o">=</span>gpgpumdhs <span class="nt">--mem</span> 20000 <span class="nt">--gres</span><span class="o">=</span>gpu:p100:1 <span class="nt">--time</span> 00:30:00 <span class="nt">--cpus-per-task</span><span class="o">=</span>1
</code></pre></div></div><ul><li><h3 id="step-3-change-to-home-directory-in-order-import-all-necessary-modules-to-run-code"> <a href="#step-3-change-to-home-directory-in-order-import-all-necessary-modules-to-run-code" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 3. Change to home directory, in order import all necessary modules to run code</h3></ul><p>Copy paste this command to load all necessary modules for jupyter notebook</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span><span class="p">;</span> module load Python/2.7.13-GCC-6.2.0<span class="p">;</span> module load Tkinter/2.7.11-intel-2017.u2-Python-2.7.11<span class="p">;</span> module load Python/2.7.13-GCC-6.2.0<span class="p">;</span> module load Tensorflow/1.11.0-intel-2017.u2-Python-2.7.13-GPU<span class="p">;</span> module load SAMtools/1.8-GCC-6.2.0-HTSlib-1.8<span class="p">;</span> module load BEDTools/2.27.1-spartan_gcc-6.2.0<span class="p">;</span> module load web_proxy
</code></pre></div></div><ul><li><h3 id="step-4-make-virtualenv"> <a href="#step-4-make-virtualenv" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 4. Make virtualenv</h3></ul><p>Now we make virtual environment.</p><p><code class="highlighter-rouge">p27_jp</code> is the name I have assigned for virtual environment. the name doesn’t matter - call it whatever you want. Just make sure you reference the name properly when you load Jupyter notebook (explained below).</p><p>Change to home directory (ie using command <code class="highlighter-rouge">cd</code>) to keep virtual environment here. I’m assuming that you can put it elsewhere, but this configuration worked for me.</p><p>Create env using command below:</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virtualenv p27_jp
</code></pre></div></div><p>This will take maybe 1-5 minutes.</p><ul><li><h3 id="step-5-enable-virtualenv"> <a href="#step-5-enable-virtualenv" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 5. Enable virtualenv</h3></ul><p>Now we enable virtual env as below</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source </span>p27_jp/bin/activate
</code></pre></div></div><p>Now you’re inside the virtual environment. Any libraries that you install here using pip will stay here. Any libraries you have previously installed while inside this environment will be accessible when you want to use it in future.</p><ul><li><h3 id="step-6-install-numpy-first"> <a href="#step-6-install-numpy-first" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 6. Install numpy first</h3></ul><p>You’ll see a lot of red messages - don’t worry</p><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span><span class="nv">numpy</span><span class="o">==</span>1.16.6
</code></pre></div></div><p>At this stage, you need to read 3 separate lists of installation dependencies. I’ve stored them in my folder on the cluster - see path below. They are also stored within this github repository - if you download the repo, they are in main folder called ‘handover_installs’</p><p>Again, you will see some red messages when installing - this is expected</p><ul><li><h3 id="step-7-install-first-list-of-dependencies"> <a href="#step-7-install-first-list-of-dependencies" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 7. Install first list of dependencies</h3></ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">-r</span> /data/projects/punim0614/archer/handover_installs/pip_inst_1.txt
</code></pre></div></div><ul><li><h3 id="step-8-then-install-second-list-of-dependencies"> <a href="#step-8-then-install-second-list-of-dependencies" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 8. Then install second list of dependencies</h3></ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">-r</span> /data/projects/punim0614/archer/handover_installs/pip_inst_2.txt
</code></pre></div></div><ul><li><h3 id="step-9--then-install-third-list-of-dependencies"> <a href="#step-9--then-install-third-list-of-dependencies" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 9. Then install third list of dependencies</h3></ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install</span> <span class="nt">-r</span> /data/projects/punim0614/archer/handover_installs/pip_inst_3.txt
</code></pre></div></div><ul><li><h3 id="step-10-deactivate-virtual-environment"> <a href="#step-10-deactivate-virtual-environment" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 10. Deactivate virtual environment</h3></ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deactivate
</code></pre></div></div><ul><li><h3 id="step-11-deactivate-sinteractive-session"> <a href="#step-11-deactivate-sinteractive-session" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Step 11. Deactivate sinteractive session</h3></ul><div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">logout</span>
</code></pre></div></div><p>Ok now we can run jupyter - virtual environment is set up!</p></div></div></div></div>
